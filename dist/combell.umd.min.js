/**
 * MIT License
 *
 * Copyright (c) 2018 Bram Plessers
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("crypto"),require("axios")):"function"==typeof define&&define.amd?define(["exports","crypto","axios"],t):t(e.combell={},null,null)}(this,function(e,t,r){"use strict";function n(e,t){return e.join(t)}function u(){return Math.floor(new Date/1e3)}r=r&&r.hasOwnProperty("default")?r.default:r;var o=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(u,o){try{var a=t[u](o),i=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(i).then(function(e){n("next",e)},function(e){n("throw",e)});e(i)}("next")})}},a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=function(){function e(t,r){a(this,e),this.key=t,this.secret=r}return i(e,[{key:"getApiKey",value:function(){return this.key}},{key:"getApiSecret",value:function(){return this.secret}},{key:"getEpoch",value:function(){return u()}},{key:"getNonce",value:function(){return function(e){for(var t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<e;n+=1)t+=r.charAt(Math.floor(Math.random()*r.length));return t}(32)}},{key:"getHmacInputText",value:function(e){return n(e,"")}},{key:"options",value:function(e,t){return{headers:{Authorization:"hmac "+t,"Content-Type":"application/json","User-Agent":"combell-api-node-js"},url:e}}},{key:"inputForHmac",value:function(e,t,r){var n=t.method,u=encodeURIComponent(t.path),o=this.getEpoch(),a=this.getNonce(),i=this.getApiSecret();return{text:this.getHmacInputText([e,n,u,o,a,r]),epoch:o,nonce:a,secret:i}}},{key:"authorizationHeaderValue",value:function(e,r){var u,o,a=this.inputForHmac(e,r,null);return n([e,(u=a.text,o=a.secret,t.createHmac("sha256",o).update(u).digest("base64")),a.nonce,a.epoch],":")}},{key:"headers",value:function(e){var t=this.authorizationHeaderValue(this.getApiKey(),e);return this.options(e.url,t)}}]),e}();function s(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var p=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function f(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function h(e,t,r,n){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?l(v(e),function(n){var u=encodeURIComponent(f(n))+r;return p(e[n])?l(e[n],function(e){return u+encodeURIComponent(f(e))}).join(t):u+encodeURIComponent(f(e[n]))}).join(t):n?encodeURIComponent(f(n))+r+encodeURIComponent(f(e)):""}function l(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var v=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t};function m(e,t,r,n){t=t||"&",r=r||"=";var u={};if("string"!=typeof e||0===e.length)return u;var o=/\+/g;e=e.split(t);var a=1e3;n&&"number"==typeof n.maxKeys&&(a=n.maxKeys);var i=e.length;a>0&&i>a&&(i=a);for(var c=0;c<i;++c){var f,h,l,v,m=e[c].replace(o,"%20"),d=m.indexOf(r);d>=0?(f=m.substr(0,d),h=m.substr(d+1)):(f=m,h=""),l=decodeURIComponent(f),v=decodeURIComponent(h),s(u,l)?p(u[l])?u[l].push(v):u[l]=[u[l],v]:u[l]=v}return u}var d,g,y={encode:h,stringify:h,decode:m,parse:m},w="/accounts",x="/domains",b="/linuxhostings",k=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},R=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;r=(r||[]).filter(function(e){return e}).map(function(e){return String(e).trim()}).map(encodeURIComponent).join("/");var u=function(e){return null==e?"":"?"+y.stringify(e)}(n),o=k("/v2"+t,r+u);return{method:e,path:o,url:k("https://api.combell.com",o)}},_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;switch(e){case w:case x:case b:return R("get",e,t,r)}return R("get","")},j={general:{context:"general_error"},request_setup:{context:"request_setup_error"},no_response:{context:"no_response_received"},auth_authorization_header_invalid_format:{context:"authentication"},authorization_hmac_invalid:{context:"hmac_authorization_header_invalid"}},A=function(e){if(e.response){var t=function(e){switch(e.response.status){case 401:return j.auth_authorization_header_invalid_format.context}var t=e.response.data.error_code;return t&&(t=j[t])?t.context:j.general.context}(e);return new Error(t)}return e.request?new Error(j.no_response.context):new Error(j.general.context)},C=(d=o(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.method="get",e.abrupt("return",r(n).catch(function(e){throw A(e)}));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return d.apply(this,arguments)}),I=w,O=function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,u,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=_(I,o,a),n=t.headers(r),u=n,e.abrupt("return",C(r.url,u));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),U=(g=o(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.index(t,[r],null));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)}),H=x,z=function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,u,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=_(H,o,a),n=t.headers(r),u=n,e.abrupt("return",C(r.url,u));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),E=(function(){var e=o(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.index(t,[r],null));case 1:case"end":return e.stop()}},e,this)}))}(),b),P=function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,u,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=_(E,o,a),n=t.headers(r),u=n,e.abrupt("return",C(r.url,u));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),q=(function(){var e=o(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.index(t,[r],null));case 1:case"end":return e.stop()}},e,this)}))}(),function(){function e(t,r){a(this,e),this.key=t,this.secret=r}return i(e,[{key:"errors",value:function(){var e=o(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.message,e.next="authentication"===e.t0?3:4;break;case 3:return e.abrupt("break",5);case 4:throw t;case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"auth",value:function(){return new c(this.key,this.secret)}},{key:"getAccounts",value:function(){var e=o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O(this.auth());case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 9:case"end":return e.stop()}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}()},{key:"getAccount",value:function(){var e=o(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new Error("requires one parameter of type Number");case 2:return e.prev=2,e.next=5,U(this.auth(),t);case 5:return e.abrupt("return",e.sent);case 8:throw e.prev=8,e.t0=e.catch(2),e.t0;case 11:case"end":return e.stop()}},e,this,[[2,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getDomains",value:function(){var e=o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,z(this.auth());case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 9:case"end":return e.stop()}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}()},{key:"getHostings",value:function(){var e=o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P(this.auth());case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 9:case"end":return e.stop()}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}()}]),e}());e.default=q,Object.defineProperty(e,"__esModule",{value:!0})});
