/**
 * MIT License
 *
 * Copyright (c) 2018 Bram Plessers
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("crypto"),require("axios")):"function"==typeof define&&define.amd?define(["exports","crypto","axios"],t):t(e.combell={},null,null)}(this,function(e,t,n){"use strict";function r(e,t){return e.join(t)}function o(){return Math.floor(new Date/1e3)}n=n&&n.hasOwnProperty("default")?n.default:n;var u,a=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,u){try{var a=t[o](u),i=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(i).then(function(e){r("next",e)},function(e){r("throw",e)});e(i)}("next")})}},i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(t,n){i(this,e),this.key=t,this.secret=n}return c(e,[{key:"getApiKey",value:function(){return this.key}},{key:"getApiSecret",value:function(){return this.secret}},{key:"getEpoch",value:function(){return o()}},{key:"getNonce",value:function(){return function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r+=1)t+=n.charAt(Math.floor(Math.random()*n.length));return t}(32)}},{key:"getHmacInputText",value:function(e){return r(e,"")}},{key:"options",value:function(e,t){return{headers:{Authorization:"hmac "+t,"Content-Type":"application/json"},url:e}}},{key:"inputForHmac",value:function(e,t,n){var r=t.method,o=encodeURIComponent(t.path),u=this.getEpoch(),a=this.getNonce(),i=this.getApiSecret();return{text:this.getHmacInputText([e,r,o,u,a,n]),epoch:u,nonce:a,secret:i}}},{key:"authorizationHeaderValue",value:function(e,n){var o,u,a=this.inputForHmac(e,n,null);return r([e,(o=a.text,u=a.secret,t.createHmac("sha256",u).update(o).digest("base64")),a.nonce,a.epoch],":")}},{key:"headers",value:function(e){var t=this.authorizationHeaderValue(this.getApiKey(),e);return this.options(e.url,t)}}]),e}(),h="/accounts",f=function(e,t){return{method:e,path:"/v2"+t,url:"https://api.combell.com/v2"+t}},p=function(e){switch(e){case h:return f("get","/accounts");default:return f("get","")}},l={general:{context:"general_error"},request_setup:{context:"request_setup_error"},no_response:{context:"no_response_received"},auth_authorization_header_invalid_format:{context:"authentication"},authorization_hmac_invalid:{context:"hmac_authorization_header_invalid"}},v=function(e){if(e.response){var t=function(e){switch(e.response.status){case 401:return l.auth_authorization_header_invalid_format.context}var t=e.response.data.error_code;return t&&(t=l[t])?t.context:l.general.context}(e);return new Error(t)}return e.request?new Error(l.no_response.context):new Error(l.general.context)},d=(u=a(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.get(t,r).catch(function(e){throw v(e)}));case 1:case"end":return e.stop()}},e,this)})),function(e,t){return u.apply(this,arguments)}),m=function(){var e=a(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=p(h),r=t.headers(n),e.abrupt("return",d(n.url,r));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),y=function(){function e(t,n){i(this,e),this.key=t,this.secret=n}return c(e,[{key:"errors",value:function(){var e=a(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.message,e.next="authentication"===e.t0?3:4;break;case 3:return e.abrupt("break",6);case 4:throw t;case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"auth",value:function(){return new s(this.key,this.secret)}},{key:"getAccounts",value:function(){var e=a(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m(this.auth());case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 9:case"end":return e.stop()}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}()}]),e}();e.default=y,Object.defineProperty(e,"__esModule",{value:!0})});
